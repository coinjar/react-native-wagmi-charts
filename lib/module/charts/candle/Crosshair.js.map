{"version":3,"sources":["Crosshair.tsx"],"names":["React","StyleSheet","LongPressGestureHandler","Animated","useAnimatedGestureHandler","useSharedValue","useAnimatedStyle","useAnimatedReaction","runOnJS","clamp","CandlestickChartDimensionsContext","CandlestickChartLine","useCandlestickChart","CandlestickChartCrosshairTooltipContext","CandlestickChartCrosshair","color","onCurrentXChange","children","horizontalCrosshairProps","verticalCrosshairProps","lineProps","props","width","height","useContext","currentX","currentY","step","tooltipPosition","opacity","onGestureEvent","onActive","x","y","boundedX","value","onEnd","horizontal","transform","translateY","vertical","translateX","data","prevData","absoluteFill","position"],"mappings":"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","sourcesContent":["import * as React from 'react';\nimport { StyleSheet, ViewProps } from 'react-native';\nimport {\n  GestureEvent,\n  LongPressGestureHandler,\n  LongPressGestureHandlerEventPayload,\n  LongPressGestureHandlerProps,\n} from 'react-native-gesture-handler';\nimport Animated, {\n  useAnimatedGestureHandler,\n  useSharedValue,\n  useAnimatedStyle,\n  useAnimatedReaction,\n  runOnJS,\n} from 'react-native-reanimated';\nimport { clamp } from 'react-native-redash';\n\nimport { CandlestickChartDimensionsContext } from './Chart';\nimport { CandlestickChartLine, CandlestickChartLineProps } from './Line';\nimport { useCandlestickChart } from './useCandlestickChart';\nimport { CandlestickChartCrosshairTooltipContext } from './CrosshairTooltip';\n\ntype CandlestickChartCrosshairProps = LongPressGestureHandlerProps & {\n  color?: string;\n  children?: React.ReactNode;\n  onCurrentXChange?: (value: number) => unknown;\n  horizontalCrosshairProps?: Animated.AnimateProps<ViewProps>;\n  verticalCrosshairProps?: Animated.AnimateProps<ViewProps>;\n  lineProps?: Partial<CandlestickChartLineProps>;\n};\n\nexport function CandlestickChartCrosshair({\n  color,\n  onCurrentXChange,\n  children,\n  horizontalCrosshairProps = {},\n  verticalCrosshairProps = {},\n  lineProps = {},\n  ...props\n}: CandlestickChartCrosshairProps) {\n  const { width, height } = React.useContext(CandlestickChartDimensionsContext);\n  const { currentX, currentY, step } = useCandlestickChart();\n\n  const tooltipPosition = useSharedValue<'left' | 'right'>('left');\n\n  const opacity = useSharedValue(0);\n  const onGestureEvent = useAnimatedGestureHandler<\n    GestureEvent<LongPressGestureHandlerEventPayload>\n  >({\n    onActive: ({ x, y }) => {\n      const boundedX = x <= width - 1 ? x : width - 1;\n      if (boundedX < 100) {\n        tooltipPosition.value = 'right';\n      } else {\n        tooltipPosition.value = 'left';\n      }\n      opacity.value = 1;\n      currentY.value = clamp(y, 0, height);\n      currentX.value = boundedX - (boundedX % step) + step / 2;\n    },\n    onEnd: () => {\n      opacity.value = 0;\n      currentY.value = -1;\n      currentX.value = -1;\n    },\n  });\n  const horizontal = useAnimatedStyle(() => ({\n    opacity: opacity.value,\n    transform: [{ translateY: currentY.value }],\n  }));\n  const vertical = useAnimatedStyle(() => ({\n    opacity: opacity.value,\n    transform: [{ translateX: currentX.value }],\n  }));\n\n  useAnimatedReaction(\n    () => currentX.value,\n    (data, prevData) => {\n      if (data !== -1 && data !== prevData && onCurrentXChange) {\n        runOnJS(onCurrentXChange)(data);\n      }\n    }\n  );\n\n  return (\n    <LongPressGestureHandler\n      minDurationMs={0}\n      maxDist={999999}\n      onGestureEvent={onGestureEvent}\n      {...props}\n    >\n      <Animated.View style={StyleSheet.absoluteFill}>\n        <Animated.View\n          style={[StyleSheet.absoluteFill, horizontal]}\n          {...horizontalCrosshairProps}\n        >\n          <CandlestickChartLine color={color} x={width} y={0} {...lineProps} />\n          <CandlestickChartCrosshairTooltipContext.Provider\n            value={{ position: tooltipPosition }}\n          >\n            {children}\n          </CandlestickChartCrosshairTooltipContext.Provider>\n        </Animated.View>\n        <Animated.View\n          style={[StyleSheet.absoluteFill, vertical]}\n          {...verticalCrosshairProps}\n        >\n          <CandlestickChartLine color={color} x={0} y={height} {...lineProps} />\n        </Animated.View>\n      </Animated.View>\n    </LongPressGestureHandler>\n  );\n}\n"]}